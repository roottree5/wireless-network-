

# 스마트 도어락 시스템 프로젝트_서준원

## 서준원 역할 및 작업 내용
---


### 1. 센서 데이터 MySQL 업로드

**목표**:  
팀원이 제공한 다양한 센서 데이터를 Arduino를 사용하여 MySQL 데이터베이스에 업로드하는 작업을 맡았습니다. **수집된 센서 데이터를 실시간으로 MySQL 데이터베이스에 삽입하는 코드를 구현했습니다.**

**과정**:  
Arduino에서 센서 데이터를 읽어 MySQL 서버로 전송하는 과정에서, **MySQL_Connection** 및 **MySQL_Cursor** 라이브러리와 관련된 여러 가지 문제가 발생했습니다.

**오류 및 해결 과정**:

1. **MySQL 데이터베이스 버전 호환성 문제**:  
   MySQL 서버와 Arduino 간의 연결에 문제가 있었고, 쿼리 실행 결과가 제대로 반환되지 않았습니다. 문제는 **MySQL 서버의 버전**과 사용 중인 **Arduino 라이브러리** 간의 호환성 문제였습니다.  
   이를 해결하기 위해 **MySQL 데이터베이스 버전을 8.4.3으로 다운그레이드**하였습니다.

2. **함수에서 반환 값을 처리하지 않음**:  
   코드에서 MySQL 쿼리 실행 후 결과를 확인하는 로직에서 문제가 발생했습니다. 일부 함수가 **void 형식**이 아닌 함수였음에도 불구하고, 쿼리 실행 후 데이터를 **반환하지 않고** 처리되어 오류가 발생했습니다.
   
   **해결 방법**:  
   이 문제는 해당 함수들이 데이터를 반환하도록 수정함으로써 해결했습니다. 원래 `void` 형식으로 되어있지 않던 함수들을 반환 값을 제공하도록 코드를 수정하여, 오류가 발생하지 않도록 했습니다.
   예를 들어, **`execute()`** 함수에서 **`True` 또는 `False`** 값을 반환하도록 수정하였습니다.

3. **MySQL 연결 및 데이터 삽입 안정성 향상**:  
   MySQL 서버와의 연결이 끊어질 경우를 대비하여 연결 상태를 확인하고 자동으로 재연결하는 로직을 추가하여, 연결 안정성을 향상시켰습니다. 이를 통해 데이터가 중단 없이 삽입되었습니다.

**결과**:  
**MySQL 데이터베이스 버전 8.4.3으로 다운그레이드**하고, 함수가 반환 값을 제대로 처리하도록 수정한 후, 센서 데이터를 MySQL 데이터베이스에 안정적으로 업로드할 수 있었습니다. 또한, 반환 값 처리를 통해 데이터 삽입 결과를 확인하고, 실시간 데이터 모니터링 기능도 정상적으로 작동하게 되었습니다.

---


### 2. **MySQL 설정 수정**

**목표**:  
Arduino에서 MySQL 서버에 데이터를 업로드할 때 **MySQL 비밀번호 설정**을 조정하여 연결 문제를 해결하는 작업을 진행했습니다.

**과정**:  
MySQL의 기본 비밀번호 인증 방식인 **`caching_sha2_password`**를 사용했으나, Arduino에서는 이를 처리할 수 없어 연결이 실패하는 문제가 발생했습니다. 이를 해결하기 위해 **`mysql_native_password`** 방식으로 인증 방식을 변경하였고, 그 과정에서 몇 가지 설정을 수정했습니다.

**해결 과정**:

1. **`caching_sha2_password`에서 `mysql_native_password`로 인증 방식 변경**:
   - MySQL 8.0 이상에서 기본적으로 **`caching_sha2_password`**가 사용됩니다. 이는 보안성이 높지만, Arduino 라이브러리와 호환되지 않아 연결에 문제가 발생했습니다.
   - 이를 해결하기 위해 **`mysql_native_password`**로 인증 방식을 변경하였습니다. `mysql_native_password`는 더 오래된 인증 방식으로, 많은 MySQL 클라이언트가 이를 지원하므로 Arduino와의 호환성 문제를 해결할 수 있었습니다.

2. **인증 방식 변경 방법**:
   - MySQL에서 사용되는 비밀번호 인증 방식을 변경하려면, **MySQL 사용자 계정의 인증 플러그인**을 수정해야 합니다.
   
   **구체적인 변경 과정**:
   1. MySQL에 접속합니다:
      ```bash
      mysql -u root -p
      ```
   2. 인증 방식을 변경할 사용자 계정을 선택하여 **`mysql_native_password`** 플러그인을 설정합니다:
      ```sql
      ALTER USER 'arduino_user'@'%' IDENTIFIED WITH mysql_native_password BY 'your_password';
      ```
      - 여기서 `arduino_user`는 MySQL에서 사용 중인 사용자 이름이고, `your_password`는 해당 사용자의 비밀번호입니다.
      - `'%'`는 모든 IP에서의 접속을 허용하는 것입니다. 특정 IP에서만 접속을 허용하려면 `%` 대신 해당 IP 주소를 사용할 수 있습니다.
   3. 변경된 설정을 적용하기 위해 MySQL 서버를 재시작했습니다.
      ```bash
      sudo systemctl restart mysql
      ```

3. **MySQL 사용자 권한 재부여**:
   - 인증 방식 변경 후, 사용자 권한을 다시 확인하고 재부여했습니다. 
      ```sql
      FLUSH PRIVILEGES;
      ```
   
4. **문서 수정**:
   - MySQL의 인증 방식 변경과 관련된 설정을 확인하기 위해 **MySQL 설정 파일**`/etc/my.cnf`을 수정했습니다.
     - **기본 인증 플러그인**을 변경하기 위해서, MySQL 설정 파일에서 `default_authentication_plugin` 항목을 수정했습니다.
       ```ini
       [mysqld]
       default_authentication_plugin=mysql_native_password
       ```
     - 변경 후 MySQL 서버를 재시작하여 설정을 반영했습니다.
       ```bash
       sudo systemctl restart mysql
       ```

**결과**:  
**`caching_sha2_password`**에서 **`mysql_native_password`**로 인증 방식을 변경한 후, Arduino와 MySQL 간의 연결 문제를 해결할 수 있었습니다. 이 변경으로 Arduino가 MySQL 서버에 정상적으로 연결되고, 데이터를 업로드하는 데 성공했습니다.

---
### 3. **외부 IP 접속 허용 및 공유기 호스팅**

**목표**:  
MySQL 서버에 원격으로 접속할 수 있도록 네트워크 설정을 수정하여, 외부에서 MySQL 서버에 접근할 수 있도록 허용하는 작업을 진행했습니다.

**과정**:  
외부에서 MySQL 서버에 접근하려면 공유기에서 포트 포워딩을 설정하고, MySQL 서버와 관련된 네트워크 및 방화벽 설정을 점검해야 했습니다. 이를 통해 외부 IP에서 MySQL 서버에 원활하게 연결할 수 있도록 만들었습니다.

#### 1. **공유기에서 포트 포워딩 설정**
   - **목표**: 외부 네트워크에서 MySQL 서버에 접속할 수 있도록 공유기에서 포트 포워딩 설정을 진행했습니다.
   - **과정**:  
     - 기본적으로 MySQL은 3306번 포트를 사용하여 통신합니다. 외부에서 이 포트로 접근할 수 있도록 공유기에서 포트 포워딩을 설정했습니다.
     - 공유기의 관리 페이지에 접속하여 포트 포워딩 설정을 추가했습니다.
       1. **공유기 관리 페이지 접속**: 웹 브라우저에서 공유기의 IP 주소 `192.168.0.1`를 입력하여 로그인합니다.
       2. **포트 포워딩 설정**: 관리 페이지에서 "포트 포워딩" 항목을 찾습니다. 그곳에서 3306번 포트를 지정하여 MySQL 서버로 전달되도록 설정합니다.
          - 예를 들어:
            - **외부 포트**: 3306
            - **내부 포트**: 3306
            - **내부 IP 주소**: MySQL 서버가 설치된 컴퓨터의 IP 주소 (192.168.1.100)

#### 2. **MySQL 서버 외부 접속 허용**
   - **목표**: MySQL 서버에서 외부 IP의 접속을 허용하도록 MySQL 설정을 변경했습니다.
   - **과정**:
     - 기본적으로 MySQL은 **로컬 접속만 허용**합니다. 외부에서 접속할 수 있도록 MySQL의 설정 파일을 수정해야 했습니다.
     - MySQL의 설정 파일 `my.cnf`에서 **bind-address**를 수정하여 외부 IP에서 접속할 수 있도록 했습니다.

     **bind-address 수정**
        - `bind-address` 항목을 `0.0.0.0`으로 변경하여 모든 IP에서 MySQL 서버에 접속할 수 있도록 했습니다.
          ```ini
          bind-address = 0.0.0.0
          ```
        - **0.0.0.0**은 모든 네트워크 인터페이스에서 접속을 허용하는 의미입니다. 특정 IP에서만 접속을 허용하려면 해당 IP 주소를 넣으면 됩니다.

#### 3. **외부 IP에서 접속 테스트**
   - 설정이 모두 완료된 후, 외부 네트워크에서 MySQL에 접속할 수 있는지 테스트했습니다.
   - **MySQL Workbench** 를 통해 접속을 시도했습니다:
     ```bash
     mysql -u username -p -h [공인 IP 주소] -P 3306
     ```
     - 이때, `username`은 MySQL 사용자 계정이고, `[공인 IP 주소]`는 MySQL 서버가 호스팅된 서버의 공인 IP 주소입니다.


**결과**:  
포트 포워딩과 MySQL 설정을 통해 MySQL 서버가 외부에서 접속할 수 있도록 성공적으로 설정을 완료했습니다. 이를 통해 Arduino와 같은 원격 장치가 MySQL 서버에 데이터를 업로드할 수 있게 되었으며, 서버 접근이 원활하게 이루어졌습니다.

---

### 4. **Arduino와 센서 호환성 문제 해결**

**목표**:  
프로젝트에서 사용된 센서들이 **Arduino**와 호환되지 않아 발생한 문제를 해결했습니다.

**과정**:  
**지문 인식 센서**가 아두이노와 호환되지 않는 문제가 발생했습니다.

- 아두이노 부족으로 인하여 **Arduino Uno**를 사용하여 작성된 코드를 기반으로 진행했으나, **Wemos D1 R1** 보드에 연결했을 때 **지문 센서**가 제대로 동작하지 않는 문제가 발생했습니다.
- 여러 설정을 점검하며 해결하려 했으나, Wemos D1 R1 보드에서 센서와의 호환성 문제를 해결할 수 없었습니다.
- 결국 **Wemos D1 R2** 보드로 교체한 후, 하드웨어 설정과 핀 번호를 다시 조정하여 **지문 인식 센서**가 정상적으로 동작하도록 했습니다.

**해결**:  
Wemos D1 R2로 보드를 교체하고, 필요한 하드웨어 설정을 수정하면서 **지문 센서**와의 호환성 문제를 해결했습니다. 이로써, 모든 센서가 원활하게 작동하게 되었으며, 프로젝트 진행에 필요한 센서들의 연결 문제가 해결되었습니다.

---


## 향후 개선 사항
- **데이터베이스 보안 강화**: MySQL 서버와의 통신을 **SSL**로 암호화하여 보안을 강화할 예정입니다.
- **센서 데이터 처리 최적화**: 센서에서 수집된 데이터를 처리하는 방식에 대한 최적화를 더 진행하여, 대규모 데이터 처리가 가능한 시스템을 구축하고 싶습니다.
